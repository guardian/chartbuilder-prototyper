"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),SmallMultiples=function(){function t(e,a){(0,_classCallCheck2.default)(this,t);var r=e.sheets.data,n=e.sheets.template,i=(0,_toConsumableArray2.default)(new Set(r.map(function(t){return t.State})));d3.select("#graphicContainer svg").remove(),r.forEach(function(t){if("string"==typeof t.Cases&&(t.Cases=+t.Cases),"string"==typeof t.Date){var e=d3.timeParse("%Y-%m-%d");t.Date=e(t.Date)}});for(var l=0;l<i.length;l++)this._drawSmallChart(r,l,i,n,a)}return(0,_createClass2.default)(t,[{key:"_drawSmallChart",value:function(t,e,a,r,n){var i;i=n?2:3;var l,s=document.querySelector("#graphicContainer").getBoundingClientRect().width/i,o=.5*s;l=r[0]["margin-top"]?{top:+r[0]["margin-top"],right:+r[0]["margin-right"],bottom:+r[0]["margin-bottom"],left:+r[0]["margin-left"]}:{top:0,right:0,bottom:20,left:50},s=s-l.left-l.right,o=o-l.top-l.bottom,d3.select("#graphicContainer").append("div").attr("id",a[e]);var u="#",c=u.concat(a[e]);d3.select(c).append("div").text(a[e]).attr("class","chartSubTitle");var d=d3.select(c).append("svg").attr("width",s+l.left+l.right).attr("height",o+l.top+l.bottom).attr("id","svg").attr("overflow","hidden"),p=d.append("g").attr("transform","translate("+l.left+","+l.top+")"),f=(Object.keys(t[0]),d3.scaleBand().range([0,s]).paddingInner(.08)),m=d3.scaleLinear().range([o,0]);f.domain(t.map(function(t){return t.Date})),m.domain(d3.extent(t,function(t){return t.Cases})).nice();var h,g,b=Math.round(f.domain().length/3),C=f.domain().filter(function(t,e){return!(e%b)||e===f.domain().length-1});h=d3.axisBottom(f).tickValues(C).tickFormat(d3.timeFormat("%d %b")),g=d3.axisLeft(m).tickFormat(function(t){return t}).ticks(5),p.append("g").attr("class","x").attr("transform","translate(0,"+o+")").call(h),p.append("g").attr("class","y").call(g),p.selectAll(".bar").data(t.filter(function(t){return t.State===a[e]})).enter().append("rect").attr("class","bar").attr("x",function(t){return f(t.Date)}).style("fill",function(){return"rgb(204, 10, 17)"}).attr("y",function(t){return m(Math.max(t.Cases,0))}).attr("width",f.bandwidth()).attr("height",function(t){return Math.abs(m(t.Cases)-m(0))})}}]),t}();exports.default=SmallMultiples;