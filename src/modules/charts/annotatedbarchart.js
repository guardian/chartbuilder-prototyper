"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),AnnotatedBarChart=function t(e,n){function a(t){if(t>0)return t>1e9?t/1e9+"bn":t>1e6?t/1e6+"m":t>1e3?t/1e3+"k":t%1!=0?t.toFixed(2):t.toLocaleString();if(t<0){var e=-1*t;return e>1e9?["-"+String(e/1e9)+"bn"]:e>1e6?["-"+String(e/1e6)+"m"]:e>1e3?["-"+String(e/1e3)+"k"]:t.toLocaleString()}return t}function r(t){return t.y2>0?12:-2}function o(t){return t.y2>0?12:4}(0,_classCallCheck2.default)(this,t),console.log(e);var i,l=e.sheets.data,c=e.sheets.details,s=e.sheets.labels,u=Math.max(document.documentElement.clientWidth,window.innerWidth||0);u<610&&(i=!0),u>=610&&(i=!1);var d,f=document.querySelector("#graphicContainer").getBoundingClientRect().width,p=.5*f;d=c[0]["margin-top"]?{top:+c[0]["margin-top"],right:+c[0]["margin-right"],bottom:+c[0]["margin-bottom"],left:+c[0]["margin-left"]}:{top:0,right:0,bottom:20,left:40},f=f-d.left-d.right,p=p-d.top-d.bottom,n.select("#chartTitle").text(c[0].title),n.select("#subTitle").text(c[0].subtitle),n.select("#sourceText").html(c[0].source),n.select("#footnote").html(c[0].footnote),n.select("#graphicContainer svg").remove(),n.select("#chartKey").html("");var h,x=n.select("#graphicContainer").append("svg").attr("width",f+d.left+d.right).attr("height",p+d.top+d.bottom).attr("id","svg").attr("overflow","hidden"),g=x.append("g").attr("transform","translate("+d.left+","+d.top+")"),m=Object.keys(l[0]);c[0].xColumn?(h=c[0].xColumn,m.splice(m.indexOf(h),1)):(h=m[0],m.splice(0,1)),console.log(h,m),l.forEach(function(t){"string"==typeof t[h]&&(t[h]=+t[h]),m.forEach(function(e){t[e]=+t[e]})}),s.forEach(function(t){t.x=+t.x,t.y=+t.y,t.y2=+t.y2}),console.log(s);var y=n.scaleBand().range([0,f]).paddingInner(.08),b=n.scaleLinear().range([p,0]);y.domain(l.map(function(t){return t[h]})),b.domain(n.extent(l,function(t){return t[m[0]]})).nice();var v,C,k=y.domain().filter(function(t,e){return!(e%10)});i&&(k=y.domain().filter(function(t,e){return!(e%20)})),i?(v=n.axisBottom(y).tickValues(k),C=n.axisLeft(b).tickFormat(function(t){return a(t)}).ticks(5)):(v=n.axisBottom(y).tickValues(k),C=n.axisLeft(b).tickFormat(function(t){return a(t)})),g.append("g").attr("class","x").attr("transform","translate(0,"+p+")").call(v),g.append("g").attr("class","y").call(C),g.selectAll(".bar").data(l).enter().append("rect").attr("class","bar").attr("x",function(t){return y(t[h])}).style("fill",function(){return"rgb(204, 10, 17)"}).attr("y",function(t){return b(Math.max(t[m[0]],0))}).attr("width",y.bandwidth()).attr("height",function(t){return Math.abs(b(t[m[0]])-b(0))}),g.selectAll(".annotationLine").data(s).enter().append("line").attr("class","annotationLine").attr("x1",function(t){return y(t.x)+y.bandwidth()/2}).attr("y1",function(t){return b(t.y)}).attr("x2",function(t){return y(t.x)+y.bandwidth()/2}).attr("y2",function(t){return b(t.y2)}).style("opacity",1).attr("stroke","#000");var w=n.select("#footerAnnotations");w.html(""),i?(g.selectAll(".annotationCircles").data(s).enter().append("circle").attr("class","annotationCircle").attr("cy",function(t){return b(t.y2)+r(t)/2}).attr("cx",function(t){return y(t.x)+y.bandwidth()/2}).attr("r",8).attr("fill","#000"),g.selectAll(".annotationTextMobile").data(s).enter().append("text").attr("class","annotationTextMobile").attr("y",function(t){return b(t.y2)+o(t)}).attr("x",function(t){return y(t.x)+y.bandwidth()/2}).style("text-anchor","middle").style("opacity",1).attr("fill","#FFF").text(function(t,e){return e+1}),console.log(s.length),s.length>0&&w.append("span").attr("class","annotationFooterHeader").text("Notes: "),s.forEach(function(t,e){w.append("span").attr("class","annotationFooterNumber").text(e+1+" - "),e<s.length-1?w.append("span").attr("class","annotationFooterText").text(t.text+", "):w.append("span").attr("class","annotationFooterText").text(t.text)})):g.selectAll(".annotationText").data(s).enter().append("text").attr("class","annotationText").attr("y",function(t){return b(t.y2)}).attr("x",function(t){return y(t.x)+y.bandwidth()/2}).style("text-anchor",function(t){return t.align}).style("opacity",1).text(function(t){return t.text})};exports.default=AnnotatedBarChart;